$def with (now, total, shoal, page, pages, size)
<!DOCTYPE html>
<html>
<head>
<script src="/static/js/jquery.min.js"></script>
<script>
$$(document).ready(function () {
    $$(".squid-list").each(function (index) {
        $$(".squid-row"+index).on('click', function(){
            $$(".squid-panel"+index).toggle();
        });
    });
});
</script>
</head>
<body>


<div class="row-fluid">
    <div class="span6 offset3" style="text-align:center">
        <h2>List of Active Squids</h2>
        $if total > 0:
            <h5 class="text-success">$total active in the last $squid_active_time seconds</h5>
        $else:
            <h5 class="text-info">None active in the last $squid_active_time seconds</h5>
        </div>
<div class="row-fluid">
  <div class='span12'>
    <table class="table table-condensed table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Hostname</th>
          <th class="hidden-phone">Public IP</th>
          <th class="hidden-phone">Private IP</th>
          <th>Bytes Out</th>
          <th>City</th>
          <th class="hidden-phone">Country</th>
          <th class="hidden-phone">Latitude</th>
          <th class="hidden-phone">Longitude</th>
          <th class="hidden-phone">Last Received</th>
          <th>Alive</th>
          <th>Clock Sync</th>
          <th>Access Level</th>
       </tr>
      </thead>
      <tbody>
        $for i,squid in enumerate(shoal):
            $ last_msg = int(now - squid.last_active)
            $ alive_time = int(now - squid.created); 
            $ hour = int(alive_time/60/60)
            $ minute = int((alive_time - hour*60*60) / 60)
            $ second = int(alive_time - hour*60*60 - minute*60)
    
            $if last_msg < squid_active_time/3:
                $ state = 'success'
            $elif last_msg >= squid_active_time/3 and last_msg < squid_active_time*2/3:
                $ state = 'warning'
            $else:
                $ state = 'error'
            $if squid.global_access == True:
                $ access = 'Global'
            $else:
                $ access = 'Private'
            $if not squid.verified and squid.allow_verification == True:
                $ state = 'warning'
            $if squid.drift_detected == True:
                $ state = 'error'
            <tr class="$state squid-row$i squid-list">
                <td><span class="badge badge-$state">$((i+1)+(page-1)*size)</td>
                <td>$squid.hostname</td>
                <td class="hidden-phone">$squid.public_ip</td>
                <td class="hidden-phone">$squid.private_ip</td>
                <td>$float("{:.3f}".format(squid.load)) kB/s</td>
                <td>$squid.geo_data.city.name</td>
                <td class="hidden-phone">$squid.geo_data.country.name</td>
                <td class="hidden-phone">$squid.geo_data.location.latitude</td>
                <td class="hidden-phone">$squid.geo_data.location.longitude</td>
                <td class="hidden-phone">$(last_msg)s</td>
                <td>$(hour)h$(minute)m$(second)s</td>
                $if squid.drift_detected == True:
                    <td style="text-align: center;"><b>$("%.1fs" % squid.drift_time)</b></td>
                $else:
                    <td style="text-align: center;">âœ”</td>
                <td>$access</td>
            </tr>
            <tr class="$state squid-panel$i" style="display:none">
                <td colspan="14">$squid.error</td>
            </tr>
      </tbody>
    </table>
  </div>
</div>
$if size != 0 and pages > 1:
  <div class="row-fluid">
    <div class"span1">
      <a href="/0">Show All</a>
    </div>
  </div>
$if pages > 1:
  <div class="row-fluid"
    <div class="span12">
      <div class="pagination pagination-centered">
        <ul>
        $if page == 1:
          <li class="disabled"><a href="#">&laquo;</a></li>
          <li class="disabled"><a href="#">&lsaquo;</a></li>
        $else:
          <li><a href="?page=1">&laquo;</a></li>
          <li><a href="?page=$(page-1)">&lsaquo;</a></li>
        $if pages < 10:
          $for p in range(pages):
            $if p+1 == page:
              <li class="active"><a href="#">$(p+1)</a></li>
            $else:
              <li><a href="?page=$(p+1)">$(p+1)</a></li>
        $else:
          $ lower = 0
          $ upper = page + 3
          $if page > 5 and page <= pages:
            $ lower = page - 4 
            $ upper = page + 3
          $if page > pages - 5 and page <= pages:
            $ lower = page - 4
            $ upper = pages
          $for p in range(lower,upper):
            $if p+1 == page:
              <li class="active"><a href="#">$(p+1)</a></li>
            $else:
              <li><a href="?page=$(p+1)">$(p+1)</a></li>
          $if page < (pages - 5):
            <li><span>...</span></li>
            $for p in range(pages-2,pages):
              <li><a href="?page=$(p+1)">$(p+1)</a></li>
        $if page == pages:
          <li class="disabled"><a href="#">&rsaquo;</a></li>
          <li class="disabled"><a href="#">&raquo;</a></li>
        $else:
          <li><a href="?page=$(page+1)">&rsaquo;</a></li>
          <li><a href="?page=$pages">&raquo;</a></li>
        </ul>
      </div>
    </div>
  </div>
</body>
</html>
